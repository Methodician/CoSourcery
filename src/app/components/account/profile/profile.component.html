<section class="profile">

  <!-- Editable Profile Form -->
  <div *ngIf="isLoggedInUsersProfile">
    <h2 class="profile__title">Your Profile</h2>

    <form [formGroup]="profileForm"
          class="profile-card">
      <div class="profile-card__input-group">
        <section class="profile-image">
          <img class="profile-image__src"
              [src]="profileForm.value.imageUrl ? profileForm.value.imageUrl : '../../assets/images/logo.png'"
              alt="Profile Image">
          <input class="profile-image__input"
                accept="image/*"
                type="file"
                [hidden]="!loggedInUserId"
                (change)="onSelectProfileImage($event)">
          <div *ngIf="imageUploadPercent$">upload%: {{ imageUploadPercent$ | async }}</div>
        </section>

        <div>
          <mat-form-field class="profile-card__input"
                          [floatLabel]="'always'">
            <mat-label>First Name</mat-label>
            <input #firstName
                  matInput
                  type="text"
                  formControlName="fName"
                  maxlength="30"
                  (blur)="trimInput('fName')"
                  [readonly]="!loggedInUserId"
                  required />
            <mat-error>Please provide your first name.</mat-error>
            <mat-hint align="end">{{firstName.value.length}} / 30</mat-hint>
          </mat-form-field>

          <mat-form-field class="profile-card__input"
                          [floatLabel]="'always'">
            <mat-label>Last Name</mat-label>
            <input #lastName
                  matInput
                  type="text"
                  formControlName="lName"
                  maxlength="30"
                  (blur)="trimInput('lName')"
                  [readonly]="!loggedInUserId"
                  required />
            <mat-error>Please provide your last name.</mat-error>
            <mat-hint align="end">{{lastName.value.length}} / 30</mat-hint>
          </mat-form-field>

          <mat-form-field class="profile-card__input"
                          [floatLabel]="'always'">
            <mat-label>Alias</mat-label>
            <input #alias
                  matInput
                  type="text"
                  formControlName="alias"
                  maxlength="30"
                  (blur)="trimInput('alias')"
                  [readonly]="!loggedInUserId" />
            <mat-hint>Alternate display name.</mat-hint>
            <mat-hint align="end">{{alias?.value.length}} / 30</mat-hint>
          </mat-form-field>
        </div>
      </div>

      <mat-form-field class="profile-card__input"
                      [floatLabel]="'always'">
        <mat-label>Bio</mat-label>
        <textarea #bio
                  matInput
                  type="text"
                  formControlName="bio"
                  placeholder="Say something about yourself ..."
                  rows="5"
                  maxlength="500"
                  (blur)="trimInput('bio')"
                  [readonly]="!loggedInUserId">
        </textarea>
        <mat-hint align="end">{{bio?.value.length}} / 500</mat-hint>
      </mat-form-field>

      <div class="profile-card__input-group">
        <mat-form-field class="profile-card__input"
                        [floatLabel]="'always'">
          <mat-label>Email</mat-label>
          <!-- Not allowing email updates yet -->
          <input matInput
                type="email"
                formControlName="email"
                maxlength="50"
                (blur)="trimInput('email')"
                readonly
                required />
          <mat-error>Please provide a valid email address.</mat-error>
        </mat-form-field>

        <mat-form-field class="profile-card__input"
                        [floatLabel]="'always'">
          <mat-label>City</mat-label>
          <input matInput
                type="text"
                formControlName="city"
                maxlength="30"
                (blur)="trimInput('city')"
                [readonly]="!loggedInUserId" />
        </mat-form-field>
      </div>

      <div class="profile-card__input-group">
        <mat-form-field class="profile-card__input"
                        [floatLabel]="'always'">
          <mat-label>State</mat-label>
          <input matInput
                type="text"
                formControlName="state"
                maxlength="2"
                (blur)="trimInput('state')"
                [readonly]="!loggedInUserId" />
        </mat-form-field>

        <mat-form-field class="profile-card__input"
                        [floatLabel]="'always'">
          <mat-label>Zip Code</mat-label>
          <input matInput
                type="text"
                formControlName="zipCode"
                maxlength="5"
                (blur)="trimInput('zipCode')"
                [readonly]="!loggedInUserId" />
        </mat-form-field>
      </div>

      <button *ngIf="loggedInUserId"
              class="cos-btn"
              type="button"
              [disabled]="!profileForm.valid || profileForm.pristine"
              (click)="onSaveProfileChanges()">
        Update
      </button>
    </form>
</div>

  <!-- Read Only Profile View -->
  <div *ngIf="!isLoggedInUsersProfile && isLoggedInUsersProfile !== undefined">

      <h2 class="profile__title">{{ readOnlyUserInfo?.alias || readOnlyUserInfo?.fName }}'s Profile</h2>

      <div class="profile-card__input-group">
          <section class="profile-image">
            <img class="profile-image__src"
                [src]="readOnlyUserInfo?.imageUrl ? readOnlyUserInfo?.imageUrl : '../../assets/images/logo.png'"
                alt="Profile Image">
          </section>
  
          <div>
            <div class="profile-card__input">
              <h6 class="read-only-label">First Name</h6>
              <h3 class="read-only-text">{{ readOnlyUserInfo?.fName }}</h3>
            </div>
  
            <div class="profile-card__input">
              <h6 class="read-only-label">Last Name</h6>
              <h3 class="read-only-text">{{ readOnlyUserInfo?.lName }}</h3>
            </div>
  
            <div class="profile-card__input">
              <h6 class="read-only-label">Alias</h6>
              <h3 class="read-only-text">{{ readOnlyUserInfo?.alias }}</h3>
            </div>
          </div>
      </div>

      <div class="profile-card__input">
        <h6 class="read-only-label">Bio</h6>
        <p class="read-only-text">{{ readOnlyUserInfo?.bio }}</p>
      </div>

      <div class="profile-card__input-group">
        <div class="profile-card__input">
          <h6 class="read-only-label">Email</h6>
          <p class="read-only-text">{{ readOnlyUserInfo?.email }}</p>
        </div>

        <div class="profile-card__input">
          <h6 class="read-only-label">City</h6>
          <p class="read-only-text">{{ readOnlyUserInfo?.city }}</p>
        </div>
      </div>

      <div class="profile-card__input-group">
        <div class="profile-card__input">
          <h6 class="read-only-label">State</h6>
          <p class="read-only-text">{{ readOnlyUserInfo?.state }}</p>
        </div>

        <div class="profile-card__input">
          <h6 class="read-only-label">Zip Code</h6>
          <p class="read-only-text">{{ readOnlyUserInfo?.zipCode }}</p>
        </div>
      </div>

  </div>
</section>
