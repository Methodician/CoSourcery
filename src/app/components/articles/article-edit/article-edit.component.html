<form [formGroup]="articleEditForm" class="article-form">
	<section class="cover-image">
		<div *ngIf="!articleEditForm.value.imageUrl" class="cover-image__placeholder">Upload a cover image.</div>
    <img *ngIf="articleEditForm.value.imageUrl" class="cover-image__image" [src]="articleEditForm.value.imageUrl">
		<button *ngIf="!editCoverImage" (click)="editCoverImage = !editCoverImage">Edit Image</button>
	</section>

	<section *ngIf="editCoverImage" class="cover-image__editor">
	  <p *ngIf="currentCoverImageUpload">Progress: {{currentCoverImageUpload?.progress}}% Complete</p>
		<mat-form-field>
			<label>Image Alt Description</label>
			<input matInput #imageAlt type="text" formControlName="imageAlt" maxlength="100">
	    <mat-hint align="end">{{imageAlt.value.length}} / 100</mat-hint>
		</mat-form-field>
		<div class="file-input flex-center-align">
			<input accept="image/*"
	           type="file"
	           (change)="captureCoverImage($event.target.files[0])">
			<div>
		    <button class="accent-2"
								[disabled]="!selectedCoverImageFile"
		            (click)="uploadCoverImage()">
					Upload
				</button>
				<button (click)="editCoverImage = !editCoverImage">Close</button>
			</div>
		</div>
	</section>

	<section *ngIf="!editHeader" class="header">
    <h2>{{articleEditForm.value.title}}</h2>
    <p *ngIf="articleEditForm.value.lastUpdated">Last Updated: {{articleEditForm.value.lastUpdated.toDate() | date }}</p>
    <p>{{articleEditForm.value.introduction}}</p>
		<button (click)="editHeader = !editHeader">Edit Header</button>
	</section>

	<section *ngIf="editHeader" class="header__editor">
	  <mat-form-field>
			<label>Title</label>
			<input matInput #title type="text" formControlName="title" maxlength="100" required>
	    <mat-hint align="end">{{title.value.length}} / 100 </mat-hint>
	    <mat-error>Please give your article a title.</mat-error>
	  </mat-form-field>
	  <mat-form-field>
	    <label>Introduction</label>
	    <textarea matInput #introduction type="text" formControlName="introduction" maxlength="300" required></textarea>
	    <mat-hint align="end">{{introduction.value.length}} / 300 </mat-hint>
	    <mat-error>Please tell us a little something about what this article is about.</mat-error>
	  </mat-form-field>
		<div class="editor-controls">
			<button (click)="editHeader = !editHeader">Close</button>
		</div>
	</section>

	<section class="ckeditor-container">
		<label>Body</label>
		<div class="border">
			<ckeditor formControlName="body" [editor]="ckeditor" [config]="ckeditorConfig"></ckeditor>
		</div>
	</section>

	<section id="article-tags">
		<h3>Tags</h3>
		<p class="text italic">Use alphanumeric characters and spaces only, then press ENTER to add tag.</p>
	  <mat-form-field>
	    <mat-chip-list #chipList>
	      <mat-chip *ngFor="let articleTag of articleEditForm.value.tags" (removed)="removeTag(articleTag)">
	        {{articleTag}}
	        <mat-icon matChipRemove>cancel</mat-icon>
	      </mat-chip>
	      <input #tagInput
							 placeholder="Enter a new tag..."
	             [matChipInputFor]="chipList"
	             [matChipInputSeparatorKeyCodes]="matChipInputSeparatorKeyCodes"
	             [matChipInputAddOnBlur]="true"
	             (matChipInputTokenEnd)="isInvalidTagInput(tagInput.value) ? null : addTag($event)">
				<mat-error *ngIf="isInvalidTagInput(tagInput.value)">Alphanumeric characters and spaces only.</mat-error>
	    </mat-chip-list>
	  </mat-form-field>
	</section>

	<section class="flex-center-justify">
		<button class="accent-2"
					  [disabled]="!articleEditForm.valid"
						(click)="saveChanges()">
			Save
		</button>
	</section>
</form>
