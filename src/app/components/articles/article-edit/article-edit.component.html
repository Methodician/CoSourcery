<form [formGroup]="articleEditForm" class="article-form">
  <section class="cover-image">
    <div *ngIf="!articleEditForm.value.imageUrl" class="cover-image__placeholder">Upload a cover image.</div>
    <img *ngIf="coverImageUrl$.value" class="cover-image__image" [src]="coverImageUrl$ | async">
    <button *ngIf="!editCoverImage" (click)="editCoverImage = !editCoverImage">Edit Image</button>
  </section>

  <section *ngIf="editCoverImage" class="cover-image__editor">
    <p *ngIf="coverImageUploadTask">Progress: {{coverImageUploadPercent$ | async}}% Complete</p>
    <mat-form-field>
      <label>Image Alt Description</label>
      <input matInput #imageAlt type="text" formControlName="imageAlt" maxlength="100">
      <mat-hint align="end">{{imageAlt.value.length}} / 100</mat-hint>
    </mat-form-field>
    <div class="file-input flex-center-align">
      <input accept="image/*" type="file" (change)="onSelectCoverImage($event)">
      <div>
        <!-- <button class="accent-2" [disabled]="!selectedCoverImageFile" (click)="uploadCoverImage()">
          Save Image
        </button> -->
        <button (click)="editCoverImage = !editCoverImage">Close</button>
      </div>
    </div>
  </section>

  <section class="title">
    <h2 *ngIf="!editTitle" class="static-display">{{articleEditForm.value.title}}</h2>
    <mat-form-field *ngIf="editTitle">
      <h2><input matInput #title type="text" formControlName="title" maxlength="100" required></h2>
      <mat-hint align="end">{{title.value.length}} / 100 </mat-hint>
      <mat-error>Please give your article a title.</mat-error>
    </mat-form-field>
    <button (click)="editTitle = !editTitle">{{editTitle ? 'Close' : 'Edit Title'}}</button>
  </section>

  <section class="intro">
    <p *ngIf="!editIntro" class="static-display">{{articleEditForm.value.introduction}}</p>
    <mat-form-field *ngIf="editIntro">
      <p><textarea matInput #introduction type="text" formControlName="introduction" maxlength="300" required></textarea></p>
      <mat-hint align="end">{{introduction.value.length}} / 300 </mat-hint>
      <mat-error>Please tell us a little something about what this article is about.</mat-error>
    </mat-form-field>
    <button (click)="editIntro = !editIntro">{{editIntro ? 'Close' : 'Edit Intro'}}</button>
  </section>

  <p *ngIf="articleEditForm.value.lastUpdated">Last Updated: {{articleEditForm.value.lastUpdated.toDate() | date }}</p>

  <section class="ckeditor" [ngClass]="{'border': editBody}">
    <button (click)="editBody = !editBody">{{(editBody) ? 'Close Editor' : 'Edit Body'}}</button>
    <ckeditor formControlName="body" [editor]="ckeditor" [config]="ckeditorConfig" [disabled]="!editBody"></ckeditor>
  </section>

  <section class="tags">
    <h3>Tags</h3>

    <mat-chip-list *ngIf="!editTags">
      <mat-chip *ngFor="let articleTag of articleEditForm.value.tags">{{articleTag}}</mat-chip>
    </mat-chip-list>

    <mat-form-field *ngIf="editTags">
      <mat-chip-list #chipList>
        <mat-chip *ngFor="let articleTag of articleEditForm.value.tags" (removed)="removeTag(articleTag)">
          {{articleTag}}
          <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
        <input #tagInput [ngClass]="{'error': isInvalidTagInput(tagInput.value)}"
          [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="matChipInputSeparatorKeyCodes"
          [matChipInputAddOnBlur]="true" (matChipInputTokenEnd)="isInvalidTagInput(tagInput.value) ? null : addTag($event)">
      </mat-chip-list>
      <mat-hint [ngClass]="{'error': isInvalidTagInput(tagInput.value)}">Add new tags using alphanumeric characters and spaces only, then press ENTER to add tag.</mat-hint>
    </mat-form-field>
    <button (click)="editTags = !editTags">{{(editTags) ? 'Close' : 'Edit Tags'}}</button>
  </section>

  <section class="flex-center-justify">
    <button *ngIf="articleHasUnsavedChanges()" class="accent-2" [disabled]="!articleEditForm.valid" (click)="saveChanges()">
      Save Article
    </button>
  </section>
</form>
